<root BTCPP_format="4" >
    <include path="./subtrees/subtree_cam_find_and_track_ball.xml" />
    <BehaviorTree ID="MainTree">
        <Sequence name="root">
            <ReactiveSequence _while="control_state==2" name="pickup">
                <CamScanField  _while="!odom_calibrated"/>
                <SubTree ID="CamFindAndTrackBall" _autoremap="true" _while="odom_calibrated" />
                <SelfLocate mode="enter_field" />
            </ReactiveSequence>
            <ReactiveSequence _while="control_state==3" name="control_state-3">
                <ReactiveSequence _while="gc_game_state=='INITIAL'" name="init">
                    <CamScanField _while="!odom_calibrated"/>
                    <SubTree ID="CamFindAndTrackBall" _autoremap="true" _while="odom_calibrated" />
                    <SelfLocate mode="enter_field" />
                </ReactiveSequence>

                <ReactiveSequence _while="gc_game_state=='READY'" name="ready">
                    <CamScanField />
                    <MoveToPoseOnField x="-2.0" _while="player_role == 'striker'" vtheta_limit="2.0"  vx_limit="0.4" />
                    <MoveToPoseOnField x="-5.5" _while="player_role == 'goal_keeper'" vtheta_limit="2.0"  vx_limit="0.4" />
                    <SelfLocate mode="trust_direction" />
                </ReactiveSequence>

                <ReactiveSequence _while="gc_game_state=='SET'" name="set">
                    <SubTree ID="CamFindAndTrackBall" _autoremap="true" />
                    <SetVelocity />
                </ReactiveSequence>

                <ReactiveSequence _while="gc_game_state=='PLAY'" name="play">
                    <SubTree ID="CamFindAndTrackBall" _autoremap="true" />
                    <SelfLocate mode="trust_direction" />
                    <Sequence>
                        <StrikerDecide decision_out="{decision}" decision_in="{decision}" chase_threshold="1.2" />
                        <RobotFindBall _while="decision == 'find'" vyaw_limit="1.0" />
                        <Chase   _while="decision == 'chase'"  vx_limit="1.0"  vy_limit="0.4"  vtheta_limit="1.0"  dist="1.0"/>
                        <Adjust  _while="decision == 'adjust'"     turn_threshold="0.4" max_range="0.6" min_range="0.4" vx_limit="0.2" vy_limit="0.2" vtheta_limit="1.0"  />
                        <Sequence  _while="decision == 'kick'">
                            <SetVelocity />
                            <Sleep msec="1000" />
                            <Kick vx_limit="1.2" vy_limit="0.4" min_msec_kick="1000"/>
                        </Sequence>
                    </Sequence>
                </ReactiveSequence>

                <ReactiveSequence _while="gc_game_state=='END'" name="end">
                    <SetVelocity />
                </ReactiveSequence>
            </ReactiveSequence>
        </Sequence>
    </BehaviorTree>
</root>
