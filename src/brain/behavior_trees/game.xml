<root BTCPP_format="4">
    <include path="./subtrees/subtree_cam_find_and_track_ball.xml" />
    <include path="./subtrees/subtree_carrot_striker_play.xml" />
    <include path="./subtrees/subtree_carrot_goalie_play.xml" />
    <include path="./subtrees/subtree_striker_freekick_ready.xml" />
    <include path="./subtrees/subtree_goalie_freekick_ready.xml" />
    <include path="./subtrees/subtree_auto_standup_and_locate.xml" />
    <BehaviorTree ID="MainTree">
        <Sequence name="root">
            <RunOnce> <Script code="treat_person_as_robot:=false" /> </RunOnce>

            <ReactiveSequence _while="control_state==2" name="pickup">
                <SubTree ID="CamFindAndTrackBall" _autoremap="true" />
                <InitializeSelfLocate/>
                <SetVelocity />
            </ReactiveSequence>

            <ReactiveSequence _while="control_state==3" name="control_state-3">
                <SubTree ID="AutoGetUpAndLocate" _autoremap="true" />

                <ReactiveSequence _while="gc_is_under_penalty" name="penalty">
                    <SubTree ID="CamFindAndTrackBall" _autoremap="true" />
                    <InitializeSelfLocate/>
                    <SetVelocity />
                </ReactiveSequence>

                <ReactiveSequence _while="!gc_is_under_penalty" name="normal">
                    <ReactiveSequence _while="gc_game_sub_state_type=='NONE'" name="normal-none">

                        <ReactiveSequence _while="gc_game_state=='INITIAL'" name="init">
                            <!-- <SubTree ID="CamFindAndTrackBall" _autoremap="true" /> -->
                            <CamScanField high_pitch="0.3" low_pitch="0.9" left_yaw="0.8" right_yaw="-0.8" msec_cycle="4000" />
                            <SelfLocate/>
                        </ReactiveSequence>

                        <ReactiveSequence _while="gc_game_state=='READY'" name="ready">
                            <!-- <SubTree ID="CamFindAndTrackBall" _autoremap="true" /> -->
                            <CamScanField high_pitch="0.3" low_pitch="0.9" left_yaw="0.8" right_yaw="-0.8" msec_cycle="4000" />
                            <SelfLocate/>
                            <!-- <BlockGoal _while="player_role == 'striker'" dist_to_ball="1.7" /> -->
                            <!-- <KeepGoal _while="player_role == 'goal_keeper'" min_ball_dist="3.0" /> -->
                            <MoveToPoseOnField _while="player_role == 'striker' && player_id == 0" x="-1.7" y="1.0" theta="0.0"/>
                            <MoveToPoseOnField _while="player_role == 'striker' && player_id == 1" x="-1.7" y="0.0" theta="0.0"/>
                            <MoveToPoseOnField _while="player_role == 'striker' && player_id == 2" x="-1.7" y="-1.0" theta="0.0"/>
                            <MoveToPoseOnField _while="player_role == 'goal_keeper'" x="-6.0" y="0.0" theta="0.0"/>
                        </ReactiveSequence>

                        <ReactiveSequence _while="gc_game_state=='SET'" name="set">
                            <SubTree ID="CamFindAndTrackBall" _autoremap="true" />
                            <SelfLocate/>
                            <SetVelocity />
                        </ReactiveSequence>

                        <ReactiveSequence _while="gc_game_state=='PLAY'" name="play">
                            <SubTree ID="CarrotStrikerPlay" _autoremap="true" _while="player_role == 'striker'" />
                            <SubTree ID="CarrotGoaliePlay" _autoremap="true" _while="player_role == 'goal_keeper'" />
                        </ReactiveSequence>

                        <ReactiveSequence _while="gc_game_state=='END'" name="end">
                            <SetVelocity />
                        </ReactiveSequence>

                    </ReactiveSequence>

                    <ReactiveSequence _while="gc_game_sub_state_type=='FREE_KICK' && gc_game_state=='PLAY'" name="free">
                        <ReactiveSequence _while="gc_game_sub_state=='STOP'">
                            <SubTree ID="CamFindAndTrackBall" _autoremap="true" />
                            <SelfLocate />
                            <SetVelocity />
                        </ReactiveSequence>
                        <ReactiveSequence _while="gc_game_sub_state=='GET_READY'">
                            <SubTree ID="StrikerFreeKickReady" _autoremap="true" _while="player_role == 'striker'" />
                            <SubTree ID="GoalieFreeKickReady" _autoremap="true" _while="player_role == 'goal_keeper'" />
                        </ReactiveSequence>
                        <ReactiveSequence _while="gc_game_sub_state=='SET'">
                            <SubTree ID="CamFindAndTrackBall" _autoremap="true" />
                            <SelfLocate />
                            <SetVelocity />
                        </ReactiveSequence>
                    </ReactiveSequence>

                </ReactiveSequence>

            </ReactiveSequence>
        </Sequence>
    </BehaviorTree>
</root>
