<root BTCPP_format="4" >
    <include path="./subtrees/subtree_cam_find_and_track_ball.xml" />
    <BehaviorTree ID="MainTree">
        <Sequence name="root">
            <ReactiveSequence _while="control_state==2" name="pickup">
                <CamScanField _while="!odom_calibrated" high_pitch="0.2" low_pitch="0.4"/>
                <SubTree ID="CamFindAndTrackBall" _autoremap="true" _while="odom_calibrated" />
                <SelfLocate />
            </ReactiveSequence>
            <ReactiveSequence _while="control_state==3" name="control_state-3">
                <ReactiveSequence _while="gc_game_state=='INITIAL'" name="init">
                    <CamScanField _while="!odom_calibrated" high_pitch="0.2" low_pitch="0.4"/>
                    <SubTree ID="CamFindAndTrackBall" _autoremap="true" _while="odom_calibrated" />
                    <SelfLocate />
                </ReactiveSequence>

                <ReactiveSequence _while="gc_game_state=='READY'" name="ready">
                    <CamScanField />
                    <MoveToPoseOnField x="-5.5" vtheta_limit="2.0"  vx_limit="0.4" />
                    <SelfLocate />
                </ReactiveSequence>

                <ReactiveSequence _while="gc_game_state=='SET'" name="set">
                    <SubTree ID="CamFindAndTrackBall" _autoremap="true" />
                    <SetVelocity />
                    <SelfLocate />
                </ReactiveSequence>

                <ReactiveSequence _while="gc_game_state=='PLAY'" name="play">
                    <!-- <CamScanField _while="!odom_calibrated" high_pitch="0.3" low_pitch="0.8" /> -->
                    <SubTree ID="CamFindAndTrackBall" _autoremap="true" />
                    <SelfLocate />
                    <Sequence>
                        <GoalieDecide decision_out="{decision}" decision_in="{decision}" x_out="{x}" y_out="{y}" chase_threshold="1.2" />
                        <Sequence _while="decision == 'find'">
                            <RobotFindBall _while="ball_range <= 3.0" vyaw_limit="1.0" />
                            <MoveToPoseOnField _while="ball_range > 3.0" long_range_threshold="100.0" x="{x}" y="{y}" />
                        </Sequence>
                        <MoveToPoseOnField _while="decision == 'retreat'" long_range_threshold="100.0" x="{x}" y="{y}"/>
                        <SetVelocity _while="decision == 'wait' " />
                        <Chase   _while="decision == 'chase'"  vx_limit="1.0"  vy_limit="0.4"  vtheta_limit="1.0"  dist="1.0"/>
                        <Adjust  _while="decision == 'adjust'"   position="defense" turn_threshold="0.4" max_range="0.6" min_range="0.4" vx_limit="0.2" vy_limit="0.2" vtheta_limit="1.0"  />
                        <Sequence  _while="decision == 'kick'">
                            <SetVelocity />
                            <Sleep msec="1000" />
                            <Kick vx_limit="1.2" vy_limit="0.4" min_msec_kick="1000"/>
                        </Sequence>
                    </Sequence>
                </ReactiveSequence>
            </ReactiveSequence>
        </Sequence>
    </BehaviorTree>
</root>
